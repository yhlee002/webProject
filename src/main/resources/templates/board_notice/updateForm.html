<!DOCTYPE HTML>
<html lang="ko"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/config.html :: configFragment"></head>

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/assets/summernote-0.8.18/summernote-lite.min.css}">
    <style>
        button {
            background-color: white;
        }
    </style>
</th:block>
<th:block layout:fragment="script">
    <script th:src="@{/assets/summernote-0.8.18/summernote-lite.min.js}"></script>
    <script th:src="@{/assets/summernote-0.8.18/lang/summernote-ko-KR.js}"></script>
    <script>
        $(document).ready(function () {
            let token = $("meta[name='_csrf']").attr("content");
            let header = $("meta[name='_csrf_header']").attr("content");

            $('#summernote').summernote(
                {
                    height: 300,                 // 에디터 높이
                    // minHeight: null,             // 최소 높이
                    // maxHeight: null,             // 최대 높이
                    focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
                    lang: "ko-KR",					// 한글 설정
                    tabsize: 1,
                    toolbar: [
                        ['style', ['style']],
                        ['fontname', ['fontNames']],
                        ['fontsize', ['fontsize']],
                        ['color', ['color']], // 'forecolor',
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['table', ['table']],
                        ['insert', ['link', 'picture', 'video']],
                        ['view', ['codeview', 'help']] // 'fullscreen'
                    ],
                    style: ['bold', 'italic', 'underline', 'strikethrough', 'clear'],
                    fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', '맑은 고딕', '궁서', '굴림체', '굴림', '돋음체', '바탕체'],
                    fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36', '50', '72'],
                    callbacks: {
                        onImageUpload: function (files) {
                            uploadSummernoteImageFile(files[0], this);
                        },
                        onPaste: function (data) {
                            let clipboardData = data.originalEvent.clipboardData;
                            if (clipboardData && clipboardData.items && clipboardData.items.length) {
                                data.preventDefault();
                            }
                        }
                    }

                }
            );

            function uploadSummernoteImageFile(file, editor) {
                let data = new FormData();
                data.append("file", file);
                $.ajax({
                    data: data,
                    type: "post",
                    url: "/uploadSummernoteImageFile",
                    contentType: false,
                    processData: false,
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },
                    success: function (data) {
                        console.log("data : "+data);
                        $(editor).summernote('insertImage', data.url);
                    },
                    error: function (request, status) {
                        alert("문제가 발생했습니다. 지속될 경우 관리자에 문의바랍니다.");
                        console.log("code : " + status + "\nmessage : " + request.responseText);
                    }
                });
            }

            $('#noticeUpdateSubmitBtn').on("click", function () {
                let boardId = $('#boardId').val();
                let title = $('#notice_title').val();
                let writerNo = $('#writerNo').val();
                let content = $('.note-editable').html();
                console.log("title : "+title+"\nwriterNo : "+writerNo+"\ncontent : "+content);

                $.ajax({
                    url: "/notice/updateProc",
                    type: 'post',
                    dataType: 'text',
                    data: {
                        'boardId': boardId,
                        'title': title,
                        'writerNo': writerNo,
                        'content': content
                    },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },
                    success: function (data) {
                        console.log("board id : "+data);
                        location.href="/notice/"+data;
                    },
                    error: function (request, status) {
                        alert("문제가 발생했습니다. 지속될 경우 관리자에 문의바랍니다."+"title : "+title);
                        console.log("code : " + status + "\nmessage : " + request.responseText);
                    }
                });
            });
        });

    </script>
</th:block>
<body>
<header th:replace="fragments/header.html :: headerFragment"></header>
<div id="one" class="wrapper style2">
    <div class="inner">
        <div class="box align-center">
            <div class="content">
                <div class="image fit">
                    <img th:src="@{/images/banner-notice.jpg}" alt="">
                </div>
                <h2>Write Notice</h2>
                <input type="text" name="boardId" id="boardId" th:value="${board.getBoardId()}">
                <input type="text" name="title" id="notice_title" style="margin:1em auto; text-align: left" th:value="${board.getTitle()}">
                <input type="text" name="writerNo" id="writerNo" hidden="hidden" th:value="${session.member.getMemNo()}">
                <form method="post">
                    <textarea id="summernote" name="editordata" th:utext="${board.getContent()}"></textarea>
                </form>
                <button id="noticeUpdateSubmitBtn" type="button" class="button">완료</button>
            </div>
        </div>
    </div>
</div>
<footer th:replace="fragments/footer.html :: footerFragment"></footer>
</body>
</html>